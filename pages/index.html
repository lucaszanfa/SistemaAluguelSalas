<!DOCTYPE html>

<html lang="pt-BR">

<head>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Sistema de Aluguel de Salas</title>

  <link rel="stylesheet" href="/assets/css/index.css">

</head>

<body>



<!-- header injected by /assets/js/common.js -->



<div class="container">

  <div class="hero">

    <div class="left">

      <p class="eyebrow">Sistema inteligente</p>

      <h1>Ache o seu Espaço perfeito em minutos</h1>

      <p class="lead">Salas e auditórios equipados para reuniões, treinamentos e eventos corporativos com acompanhamento em tempo real.</p>

      <div class="search">

        <input id="search" type="text" placeholder="Buscar por nome ou recurso..." />

        <input id="filterDate" type="date" />

        <input id="filterTime" type="time" />

        <button class="btn ghost dark" onclick="limpar()">Limpar</button>

      </div>

      <div class="quick-actions">

        <button class="btn ghost dark" onclick="location.href='/rooms.html'">Ver catálogo completo</button>

        <button class="btn primary" onclick="location.href='/register.html'">Criar conta gratuita</button>

      </div>

      <div class="hero-stats">

        <div class="stat">

          <strong>+80</strong>

          <span>Espaços equipados</span>

        </div>

        <div class="stat">

          <strong>92%</strong>

          <span>Ocupação otimizada</span>

        </div>

        <div class="stat">

          <strong>24/7</strong>

          <span>Gestão online</span>

        </div>

      </div>

    </div>

    <div class="right">

      <div class="hero-stack">

        <div class="hero-card primary">

          <h4>Agenda inteligente</h4>

          <p>Visualize a disponibilidade diária e bloqueie conflitos automaticamente.</p>

          <ul>

            <li>Confirmação instantânea</li>

            <li>Lembretes automáticos</li>

            <li>Cancelamento simples</li>

          </ul>

        </div>

        <div class="hero-card secondary">

          <h4>Salas prontas para uso</h4>

          <p>Recursos mais solicitados:</p>

          <div class="hero-tags">

            <span class="pill">Projetor 4K</span>

            <span class="pill">Quadro digital</span>

            <span class="pill">Streaming</span>

            <span class="pill">Coffee break</span>

          </div>

        </div>

      </div>

    </div>

  </div>



  <div class="grid">

    <aside class="filters">

      <h3>Filtros</h3>

      <p style="margin: 10px 0 5px;">Capacidade mínima</p>

      <input type="number" id="capacidade" />

      <p style="margin: 15px 0 5px;">Ordenar por</p>

      <select id="ordenar">

        <option value="recomendado">Recomendado</option>

        <option value="preco-menor">Preço menor</option>

        <option value="preco-maior">Preço maior</option>

        <option value="capacidade">Maior capacidade</option>

      </select>

      <p style="margin-top: 15px;"><input type="checkbox" id="disponivel" /> Apenas disponíveis</p>

      <p style="margin-top: 10px;">Pesquisar por data: <input type="date" id="searchByDate" style="margin-left:8px;" /></p>

      <p style="margin-top: 10px;">Horário: <input type="time" id="searchByTime" style="margin-left:8px;" /></p>

      <p style="font-size: 12px; color:#777; margin-top:20px;">Clique em "Reservar" para simular a reserva.</p>

    </aside>



    <div>

      <div id="lista" class="rooms"></div>

    </div>

  </div>

</div>



<!-- Login simples -->

<div id="loginBox">

  <h4>Entrar</h4>

  <input id="email" placeholder="email" />

  <input id="password" placeholder="senha" type="password" />

  <button onclick="login()">Entrar</button>

  <p style="font-size:13px;margin-top:6px;">Não possui uma conta? <a href="/register.html">Registre-se agora</a></p>

</div>



<script src="/assets/js/common.js"></script>

<script>

const API_URL = "http://localhost:3000/api";

let rooms = [];

let favorites = [];

let user = null;

let token = localStorage.getItem('token') || null;

if (token) { const storedName = localStorage.getItem('userName'); if (storedName) user = { id: token, name: storedName }; }

async function carregarSalas() {

  try {

    const search = encodeURIComponent(document.getElementById('search').value || '');

    const cap = encodeURIComponent(document.getElementById('capacidade').value || '');

    const date = document.getElementById('filterDate').value || document.getElementById('searchByDate').value || '';
    const time = document.getElementById('filterTime').value || document.getElementById('searchByTime').value || '';

    let url = `${API_URL}/rooms?search=${search}`;

    if (cap) url += `&capacity=${cap}`;

    if (date) url += `&date=${date}`;
    if (time) url += `&time=${time}`;

    const res = await fetch(url);

    rooms = await res.json();

    if (user) await carregarFavoritos();

    render();

  } catch (e) { document.getElementById('lista').innerHTML = "<p style='color:red;'>Erro ao conectar com a API.</p>"; }

}

function render(){

  const search = document.getElementById('search').value.toLowerCase();

  const cap = Number(document.getElementById('capacidade').value || 0);

  const disp = document.getElementById('disponivel').checked;

  const ord = document.getElementById('ordenar').value;

  let lista = rooms.filter(r => r.name.toLowerCase().includes(search));

  if (cap > 0) lista = lista.filter(r => r.capacity >= cap);

  if (disp) lista = lista.filter(r => r.available);

  if (ord === 'preco-menor') lista.sort((a,b)=>a.price-b.price);

  if (ord === 'preco-maior') lista.sort((a,b)=>b.price-a.price);

  if (ord === 'capacidade') lista.sort((a,b)=>b.capacity-a.capacity);

  const box = document.getElementById('lista'); box.innerHTML='';

  if(!lista.length){ box.innerHTML = `<p style='color:#666;'>Nenhuma sala encontrada.</p>`; return; }

  for(const r of lista){ const isFav = favorites.find(f => Number(f.id) === Number(r.id)) || favorites.find(f => Number(f.roomId)===Number(r.id)); const imgSrc = r.image || `/assets/images/sala${r.id}.jpg`; box.innerHTML += `

    <div class='room-card'>

      <a href="/room.html?id=${r.id}" style="text-decoration:none;color:inherit"><div class='thumb'><img src='${imgSrc}' alt='${r.name}' onerror="this.style.display='none'"></div></a>

      <div class='body'>

        <h3>${r.name}</h3>

        <div class='room-meta'>Capacidade: ${r.capacity} • R$ ${r.price}/h • <span style='color:${r.available ? "green" : "red"}'>${r.available ? "Disponível" : "Ocupada"}</span></div>

        <div class='room-actions'><button class='btn primary' onclick='reservar(${r.id})'>Reservar</button> <a class='btn' href="/room.html?id=${r.id}">Detalhes</a> <button class='fav-btn' onclick='toggleFavorite(${r.id})'>${isFav ? '★' : '☆'}</button></div>

      </div>

    </div>`; }

}

function reservar(idSala){
  if(!token) return alert('Precisa entrar para reservar.');
  const defaultDate = document.getElementById('filterDate').value || document.getElementById('searchByDate').value || '';
  showReservationModal({
    date: defaultDate,
    onConfirm: async ({ date, time })=>{
      try{
        const body = { userId: token, date };
        if(time) body.time = time;
        const res = await fetch(`${API_URL}/rooms/${idSala}/reserve`, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(body)
        });
        const data = await res.json();
        if(!res.ok){ alert(data.error || 'Erro ao reservar'); return; }
        closeReservationModal();
        const reservation = data.reservation;
        if(reservation && reservation.id){
          location.href = `/reservation_confirm.html?id=${reservation.id}`;
          return;
        }
        alert(data.message || 'Reserva efetuada!');
        carregarSalas();
      } catch(e){
        alert('Erro ao reservar sala.');
      }
    }
  });
}

async function toggleFavorite(roomId){ if(!token) return alert('Precisa entrar para favoritar.'); try{ const res = await fetch(`${API_URL}/favorites`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ userId: token, roomId }) }); const data = await res.json(); alert(data.message || 'Atualizado'); await carregarFavoritos(); render(); } catch(e){ console.error(e); } }

async function carregarFavoritos(){ if(!token){ favorites = []; return; } try{ const res = await fetch(`${API_URL}/favorites?userId=${token}`); favorites = await res.json(); } catch(e){ favorites = []; } }

function toggleLogin(){ const box = document.getElementById('loginBox'); box.style.display = box.style.display === 'none' ? 'block' : 'none'; }

async function login(){ const email = document.getElementById('email').value; const password = document.getElementById('password').value; if(!email||!password) return alert('Preencha email e senha'); try{ const res = await fetch(`${API_URL}/login`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email, password }) }); const data = await res.json(); if(!res.ok) return alert(data.error || 'Falha no login'); token = data.token; user = data.user; localStorage.setItem('token', token); localStorage.setItem('userName', user.name); location.reload(); } catch(e){ console.error(e); alert('Erro ao logar'); } }

function logout(){ token=null;user=null;localStorage.removeItem('token');localStorage.removeItem('userName'); favorites=[]; carregarSalas(); }

function limpar(){ document.getElementById('search').value=''; document.getElementById('capacidade').value=''; document.getElementById('disponivel').checked=false; document.getElementById('ordenar').value='recomendado'; document.getElementById('filterDate').value=''; const sb = document.getElementById('searchByDate'); if(sb) sb.value=''; const st = document.getElementById('searchByTime'); if(st) st.value=''; const ft = document.getElementById('filterTime'); if(ft) ft.value=''; render(); }

document.addEventListener('DOMContentLoaded', ()=>{ document.querySelectorAll('input, select').forEach(e=>e.addEventListener('input', carregarSalas)); carregarSalas(); });

</script>

</body>

</html>

